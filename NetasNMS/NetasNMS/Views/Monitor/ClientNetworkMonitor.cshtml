
@{
    ViewBag.Title = "Client Network Monitor";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- BEGIN CONTENT -->
<div class="page-content-wrapper">
    <!-- BEGIN CONTENT BODY -->
    <div class="page-content">
        <!-- BEGIN PAGE HEADER-->
        <h1 class="page-title">
            Monitor
        </h1>
        <div class="page-bar">
            <ul class="page-breadcrumb">
                <li>
                    <i class="icon-home"></i>
                    <a href="/Dashboard/Index">Home</a>
                    <i class="fa fa-angle-right"></i>
                </li>
                <li>
                    <span>Client Monitor</span>
                </li>
            </ul>
        </div>
        <!-- END PAGE HEADER-->
        <div class="row">
            <div class="col-md-5">
                <!-- BEGIN VALIDATION STATES-->
                <div class="portlet light ">
                    <div class="portlet-title">
                        <div class="caption">
                            <i class=" icon-settings font-green"></i>
                            <span class="caption-subject font-green sbold uppercase">CLIENT INFORMATION FILTER ACTION</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <!-- BEGIN FORM-->
                        <form action="#" class="form-horizontal" id="acnetworkmonitorform">
                            <div class="form-body">
                                <div class="alert alert-danger display-hide">
                                    <button class="close" data-close="alert"></button> You have some form errors. Please check below.
                                </div>
                                <div class="alert alert-success display-hide">
                                    <button class="close" data-close="alert"></button> Your form validation is successful!
                                </div>
                                <!-------------------------Time Filter Begin----------------------------->
                                <div class="form-group form-md-radios">
                                    <label style="border-bottom: 1px solid #eee; text-align:left; font-weight:bold" class="control-label  col-md-12" for="form_control_1">Time Filter</label>
                                </div>
                                <div class="form-body">
                                    <div class="form-group form-md-radios">
                                        <div class="col-md-1">
                                            <div class="md-radio-inline">
                                                <div class="md-radio">
                                                    <input checked type="radio" id="checkbox1_1" name="radioTimeFilter" value="Last" class="md-radiobtn">
                                                    <label for="checkbox1_1">
                                                        <span></span>
                                                        <span class="check"></span>
                                                        <span class="box"></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <label class="col-md-2 control-label" for="form_control_1" style="text-align:left">
                                            Last Record
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-1">
                                            <div class="md-radio-inline">
                                                <div class="md-radio">
                                                    <input type="radio" id="checkbox1_2" name="radioTimeFilter" value="Calender" class="md-radiobtn">
                                                    <label for="checkbox1_2">
                                                        <span></span>
                                                        <span class="check"></span>
                                                        <span class="box"></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-5">
                                            <div id="filterStartDate" class="input-group date form_date form_datetime bs-datetime">
                                                <input id="startDateinput" class="form-control" size="16" type="text" value="Select start date" readonly disabled>
                                                <span class="input-group-addon">
                                                    <button class="btn default date-reset" type="button">
                                                        <i class="fa fa-times"></i>
                                                    </button>
                                                </span>
                                                <span class="input-group-addon">
                                                    <button id="startDateCalBtn" class="btn default date-set" type="button" disabled>
                                                        <i class="fa fa-calendar"></i>
                                                    </button>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="col-md-5">
                                            <div id="filterEndDate" class="input-group date form_date form_datetime bs-datetime">
                                                <input id="endDateinput" class="form-control" size="16" type="text" value="Select end date" readonly disabled>
                                                <span class="input-group-addon">
                                                    <button class="btn default date-reset" type="button">
                                                        <i class="fa fa-times"></i>
                                                    </button>
                                                </span>
                                                <span class="input-group-addon">
                                                    <button id="endDateCalBtn" class="btn default date-set" type="button" disabled>
                                                        <i class="fa fa-calendar"></i>
                                                    </button>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-------------------------Time Filter End----------------------------->
                                <!-------------------------Group Filter Begin----------------------------->
                                <div class="form-group form-md-radios">
                                    <label style="border-bottom: 1px solid #eee; text-align:left; font-weight:bold" class="control-label  col-md-12" for="form_control_1">Group Filter</label>
                                </div>
                                <div class="form-body">
                                    <div class="form-group form-md-radios">
                                        <div class="col-md-1">
                                            <div class="md-radio-inline">
                                                <div class="md-radio">
                                                    <input checked type="radio" id="checkbox1_3" name="radioGroupFilter" value="None" class="md-radiobtn">
                                                    <label for="checkbox1_3">
                                                        <span></span>
                                                        <span class="check"></span>
                                                        <span class="box"></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <label class="col-md-2 control-label" for="form_control_1" style="text-align:left">
                                            None
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-1">
                                            <div class="md-radio-inline">
                                                <div class="md-radio">
                                                    <input type="radio" id="checkbox1_4" name="radioGroupFilter" value="GroupFilter" class="md-radiobtn">
                                                    <label for="checkbox1_4">
                                                        <span></span>
                                                        <span class="check"></span>
                                                        <span class="box"></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <button id="sourceRoot" type="submit" class="btn green" disabled><i class="fa fa-sitemap"></i></button>
                                        </div>
                                        <div class="col-md-2">
                                            <button id="sourceGroup" type="submit" class="btn green" disabled><i class="fa fa-eye"></i></button>
                                        </div>
                                    </div>
                                </div>
                                <!-------------------------Group Filter End----------------------------->
                                <!-------------------------Column Filter Begin----------------------------->
                                <div class="form-group form-md-radios">
                                    <label style="border-bottom: 1px solid #eee; text-align:left; font-weight:bold" class="control-label  col-md-12" for="form_control_1">Column Filter</label>
                                </div>
                                <div class="form-body">
                                    <div class="form-group form-md-radios">
                                        <div class="col-md-1">
                                            <div class="md-radio-inline">
                                                <div class="md-radio">
                                                    <input checked type="radio" id="checkbox1_5" name="radioColumnFilter" value="none" class="md-radiobtn">
                                                    <label for="checkbox1_5">
                                                        <span></span>
                                                        <span class="check"></span>
                                                        <span class="box"></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <label class="col-md-2 control-label" for="form_control_1" style="text-align:left">
                                            None
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-1">
                                            <div class="md-radio-inline">
                                                <div class="md-radio">
                                                    <input type="radio" id="checkbox1_6" name="radioColumnFilter" value="ColumnFilter" class="md-radiobtn">
                                                    <label for="checkbox1_6">
                                                        <span></span>
                                                        <span class="check"></span>
                                                        <span class="box"></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group form-md-line-input">
                                            <div class="col-md-4">
                                                <select id="searchColumn" class="bs-select form-control selectpicker" disabled>
                                                    <option value="clientMac">Client MAC</option>
                                                    <option value="clientIP">Client IP</option>
                                                    <option value="clientIPv6">Client IPv6</option>
                                                    <option value="ssid">SSID</option>
                                                    <option value="connectType">Connection type</option>
                                                    <option value="radioInterface">Radio</option>
                                                    <option value="authenticationType">Authentication type</option><
                                                    <option value="ap_macaddress">AP MAC</option>
                                                    <option value="ap_ipaddress">AP IP</option>
                                                    <option value="ap_name">AP Name</option>
                                                    <option value="switchMacAddress">Controller MAC</option>
                                                    <option value="switchIpAddress">Controller IP</option>
                                                </select>
                                            </div>
                                            <div class="col-md-5">
                                                <div class="input-icon">
                                                    <input id="searchContent" type="text" class="form-control" placeholder="Enter special device" disabled>
                                                    <div class="form-control-focus"> </div>
                                                    <i class="fa fa-edit"></i>
                                                    <span class="help-block">Enter special device</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-------------------------Column Filter End----------------------------->
                            </div>
                            <div class="form-actions">
                                <div class="row">
                                    <div class="col-md-offset-3 col-md-9">
                                        <button id="filterQueryBtn" type="submit" class="btn green">Get Qery Filter</button>
                                        <button type="reset" class="btn default">Reset</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <!-- END FORM-->
                    </div>
                </div>
                <!-- END VALIDATION STATES-->
            </div>
            <div id="clientNetworkMonitor" class="col-md-7">
                <!-- BEGIN VALIDATION STATES-->
                <div class="portlet light ">
                    <div class="portlet-title">
                        <div class="caption">
                            <i class=" icon-settings font-green"></i>
                            <span class="caption-subject font-green sbold uppercase">AP DEVICES LIST</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <!-- BEGIN TABLE-->
                        <table id="clientNetworkTable" class="table table-striped table-bordered table-hover dt-responsive table-checkable">
                            <thead>
                                <tr>
                                    <th>
                                        <label class="mt-checkbox mt-checkbox-single mt-checkbox-outline">
                                            <input type="checkbox" class="group-checkable" data-set="#clientNetworkTable .checkboxes" />
                                            <span></span>
                                        </label>
                                    </th>
                                    <th class="all">Record Time</th>
                                    <th class="all">Client Mac</th>
                                    <th class="all">Client IP</th>
                                    <th class="none">Client IPv6</th>
                                    <th class="all">SSID</th>
                                    <th class="none">Connection Type</th>
                                    <th class="none">Radio</th>
                                    <th class="none">Client IPv6</th>
                                    <th class="none">SSID</th>
                                    <th class="none">Start Time</th>
                                    <th class="none">Link Time</th>
                                    <th class="none">Tx Utilization</th>
                                    <th class="none">Rx Utilization</th>
                                    <th class="none">Transmitted (MB)</th>
                                    <th class="none">Received (MB)</th>
                                    <th class="none">Tx Data Rate(Mbps)</th>
                                    <th class="none">Authentication type</th>
                                    <th class="none">AP MAC</th>
                                    <th class="none">AP IP</th>
                                    <th class="none">AP Name</th>
                                    <th class="none">AC MAC</th>
                                    <th class="none">AC IP</th>
                                    <th class="none">AC Name</th>
                                </tr>
                            </thead>
                            <tbody data-bind="dataTablesForEach : {
			                                data: setTableClientMonitor,
			                                options: {
				                                deferRender: true,
				                                paging: true,
				                                fixedColumns: {
					                                leftColumns: 2
				                                },
				                                scrollX: false
			                                }
		                                }">
                                <tr>
                                    <td>
                                        <label class="mt-checkbox mt-checkbox-single mt-checkbox-outline">
                                            <input type="checkbox" class="checkboxes" value="1" />
                                            <span></span>
                                        </label>
                                    </td>
                                    <td><a href="#"><span data-bind="text: moment(recordTime()).format('DD-MM-YYYY HH:mm:ss')"></span></a></td>
                                    <td><span data-bind="text: clientMac()"></span></td>
                                    <td><span data-bind="text: clientIP()"></span></td>
                                    <td><span data-bind="text: clientIPv6()"></span></td>
                                    <td><span data-bind="text: ssid()"></span></td>
                                    <td><span data-bind="text: connectType()"></span></td>
                                    <td><span data-bind="text: radioInterface()"></span></td>
                                    <td><span data-bind="text: clientIP()"></span></td>
                                    <td><span data-bind="text: clientIPv6()"></span></td>
                                    <td><span data-bind="text: moment(recordTime()).format('DD-MM-YYYY HH:mm:ss')"></span></td>
                                    <td><span data-bind="text: moment(linkTime(), 'YYYYMMDD').fromNow()"></span></td>
                                    <td><span data-bind="text: txUtil()"></span></td>
                                    <td><span data-bind="text: rxUtil()"></span></td>
                                    <td><span data-bind="text: transmitMegaByte()"></span></td>
                                    <td><span data-bind="text: receiveMegaByte()"></span></td>
                                    <td><span data-bind="text: txDataRate()"></span></td>
                                    <td><span data-bind="text: authenticationType()"></span></td>
                                    <td><span data-bind="text: apMacAddress()"></span></td>
                                    <td><span data-bind="text: ap.ipaddress()"></span></td>
                                    <td><span data-bind="text: ap.name()"></span></td>
                                    <td><span data-bind="text: controllerMac()"></span></td>
                                    <td><span data-bind="text: controllerIP()"></span></td>
                                    <td><span data-bind="text: controllerName()"></span></td>
                                </tr>
                            </tbody>
                        </table>
                        <!-- END TABLE-->
                    </div>
                </div>
                <!-- END VALIDATION STATES-->
            </div>
        </div>
    </div>
    <!-- END CONTENT BODY -->
</div>
<!-- END CONTENT -->


<script src="../assets/global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="../assets/pages/scripts/form-validation-md.min.js" type="text/javascript"></script>
<script src="../assets/pages/scripts/table-datatables-responsive.min.js" type="text/javascript"></script>

<script>
    $(function () {

    });
    $(document).ready(function () {

        $('#clientNetworkTable').find('.group-checkable').change(function () {
            var set = $(this).attr("data-set");
            var checked = $(this).is(":checked");
            $(set).each(function () {
                if (checked) {
                    $(this).prop("checked", true);
                    $(this).parents('tr').addClass("active");
                } else {
                    $(this).prop("checked", false);
                    $(this).parents('tr').removeClass("active");
                }
            });
        });

        $('#clientNetworkTable').on('change', 'tbody tr .checkboxes', function () {
            $(this).parents('tr').toggleClass("active");
        });

        var startDateFilter = 0;
        var endDateFilter = 0;
        var groupIdStr = 1;
        var searchColumn = 'none';
        var searchContent = '';
        var radioTimeFilter = $('#checkbox1_1').val();
        var radioGroupFilter = $('#checkbox1_3').val();
        var radioColumnFilter = $('#checkbox1_5').val();
        var dataCount = 0;
        //var deviceStatus =  $('#deviceStatus').find("option:selected").val();
        var pageIndex = 0;
        var column = 'recordTime';
        var method = 'asc';

        ko.bindingHandlers.dataTablesForEach = {
            page: 0,
            init: function (element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
                var binding = ko.utils.unwrapObservable(valueAccessor());

                ko.unwrap(binding.data);

                if (binding.options.paging) {
                    binding.data.subscribe(function (changes) {
                        var table = $(element).closest('table').DataTable();
                        ko.bindingHandlers.dataTablesForEach.page = table.page();
                        table.destroy();
                    }, null, 'arrayChange');
                }

                var nodes = Array.prototype.slice.call(element.childNodes, 0);
                ko.utils.arrayForEach(nodes, function (node) {
                    if (node && node.nodeType !== 1) {
                        node.parentNode.removeChild(node);
                    }
                });

                return ko.bindingHandlers.foreach.init(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext);
            },
            update: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
                var binding = ko.utils.unwrapObservable(valueAccessor()),
                    key = 'DataTablesForEach_Initialized';

                ko.unwrap(binding.data);

                var table;
                if (!binding.options.paging) {
                    table = $(element).closest('table').DataTable();
                    table.destroy();
                }

                ko.bindingHandlers.foreach.update(element, valueAccessor, allBindings, viewModel, bindingContext);

                table = $(element).closest('table').DataTable(binding.options);

                if (binding.options.paging) {
                    if (table.page.info().pages - ko.bindingHandlers.dataTablesForEach.page === 0) {
                        table.page(--ko.bindingHandlers.dataTablesForEach.page).draw(false);
                    } else {
                        table.page(ko.bindingHandlers.dataTablesForEach.page).draw(false);
                    }
                }

                if (!ko.utils.domData.get(element, key) && (binding.data || binding.length)) {
                    ko.utils.domData.set(element, key, true);
                }

                return {
                    controlsDescendantBindings: true
                };
            }
        };

        var ClientNetworkMonitor = {
            setTableClientMonitor: ko.observableArray([])
        };

        ko.applyBindings(ClientNetworkMonitor, document.getElementById('clientNetworkMonitor'));

        $("input[name=radioTimeFilter]").change(function () {
            radioTimeFilter = this.value;
            if (radioTimeFilter === 'Calender')
            {
                $("#startDateinput").attr("disabled", false);
                $("#endDateinput").attr("disabled", false);
                $("#startDateCalBtn").attr("disabled", false);
                $("#endDateCalBtn").attr("disabled", false);
                startDateFilter = (moment($('#filterStartDate').data().date).unix()) * 1000;
                endDateFilter = (moment($('#filterEndDate').data().date).unix()) * 1000;
            }
            else
            {
                $("#startDateinput").attr("disabled", true);
                $("#endDateinput").attr("disabled", true);
                $("#startDateCalBtn").attr("disabled", true);
                $("#endDateCalBtn").attr("disabled", true);
                startDateFilter = 0;
                endDateFilter = 0;
            }
        });

        $("input[name=radioGroupFilter]").change(function () {
            radioGroupFilter = this.value;
            if (radioGroupFilter === 'None') {
                $("#sourceRoot").attr("disabled", true);
                $("#sourceGroup").attr("disabled", true);
            }
            else {
                $("#sourceRoot").attr("disabled", false);
                $("#sourceGroup").attr("disabled", false);
            }
        });

        $("input[name=radioColumnFilter]").change(function () {
            radioColumnFilter = this.value;
            if (radioColumnFilter === 'none') {
                $('#searchColumn').prop('disabled', true).selectpicker('refresh');
                $("#searchContent").attr("disabled", true);
                searchColumn = 'none';
                $('#searchContent').val('');
                $('#searchContent').text('');
                console.log($('#searchContent').val());
                console.log($('#searchContent').text());
            }
            else {
                $('#searchColumn').prop('disabled', false).selectpicker('refresh');
                $("#searchContent").attr("disabled", false);
            }
        });

        $('#searchColumn').change(function () {
            searchColumn = $(this).val();
        });

        $('#filterQueryBtn').on('click', function ()
        {
            ClientNetworkMonitor.setTableClientMonitor([]);

            if (radioTimeFilter != 'Calender')
            {
                if (startDateFilter == 0 & endDateFilter == 0 & groupIdStr == 1)
                {
                    searchContent = $('#searchContent').val();
                    $.ajax({
                        url: "http://217.78.97.240:8081/data/asset/wirelessInformation/count/client/" + startDateFilter + "/" + endDateFilter + "/" + groupIdStr + "/none/" + searchColumn + "/" + searchContent,
                        success: function (ResponseClientCount) {
                            dataCount = ResponseClientCount;
                        }
                    });

                    $.ajax({
                        url: "http://217.78.97.240:8081/data/asset/wirelessInformation/client/" + startDateFilter + "/" + endDateFilter + "/100/" + pageIndex + "/" + column + "/" + method + "/" + groupIdStr + "/" + searchColumn + "/" + searchContent,
                        success: function (ResponseClientMonitors) {
                            ko.mapping.fromJS(ResponseClientMonitors, {}, ClientNetworkMonitor.setTableClientMonitor);
                        }
                    });

                }
            }
            else
            {
                startDateFilter = (moment($('#filterStartDate').data().date).unix()) * 1000;
                endDateFilter = (moment($('#filterEndDate').data().date).unix()) * 1000;
                searchContent = $('#searchContent').val();
                $.ajax({
                    url: "http://217.78.97.240:8081/data/asset/wirelessInformation/client/" + startDateFilter + "/" + endDateFilter + "/100/" + pageIndex + "/" + column + "/" + method + "/" + groupIdStr + "/" + searchColumn + "/" + searchContent,
                    success: function (ResponseClientMonitors) {
                        ko.mapping.fromJS(ResponseClientMonitors, {}, ClientNetworkMonitor.setTableClientMonitor);
                    }
                });
            }
        });

        $('.form_date').datetimepicker({
            startDate: '2017-01-01 00:01',
            language: 'en',
            //format: "dd MM yyyy - HH:ii P",
            weekStart: 1,
            todayBtn: true,
            autoclose: true,
            todayHighlight: true,
            isRTL: App.isRTL(),
            pickerPosition: (App.isRTL() ? "bottom-right" : "bottom-left")
        });

    });
</script> 