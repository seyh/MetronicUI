
@{
    ViewBag.Title = "AP Network Monitor";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- BEGIN CONTENT -->
<div class="page-content-wrapper">
    <!-- BEGIN CONTENT BODY -->
    <div class="page-content">
        <!-- BEGIN PAGE HEADER-->
        <h1 class="page-title">
            Monitor
        </h1>
        <div class="page-bar">
            <ul class="page-breadcrumb">
                <li>
                    <i class="icon-home"></i>
                    <a href="/Dashboard/Index">Home</a>
                    <i class="fa fa-angle-right"></i>
                </li>
                <li>
                    <span>AP Monitor</span>
                </li>
            </ul>
        </div>
        <!-- END PAGE HEADER-->
        <div class="row">
            <div class="col-md-5">
                <!-- BEGIN VALIDATION STATES-->
                <div class="portlet light ">
                    <div class="portlet-title">
                        <div class="caption">
                            <i class=" icon-settings font-green"></i>
                            <span class="caption-subject font-green sbold uppercase">AP INFORMATION FILTER ACTION</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <!-- BEGIN FORM-->
                        <form action="#" class="form-horizontal" id="acnetworkmonitorform">
                            <div class="form-body">
                                <div class="alert alert-danger display-hide">
                                    <button class="close" data-close="alert"></button> You have some form errors. Please check below.
                                </div>
                                <div class="alert alert-success display-hide">
                                    <button class="close" data-close="alert"></button> Your form validation is successful!
                                </div>
                                <!-------------------------Time Filter Begin----------------------------->
                                <div class="form-group form-md-radios">
                                    <label style="border-bottom: 1px solid #eee; text-align:left; font-weight:bold" class="control-label  col-md-12" for="form_control_1">Time Filter</label>
                                </div>
                                <div class="form-body">
                                    <div class="form-group form-md-radios">
                                        <div class="col-md-1">
                                            <div class="md-radio-inline">
                                                <div class="md-radio">
                                                    <input checked type="radio" id="checkbox1_1" name="radioTimeFilter" value="Last" class="md-radiobtn">
                                                    <label for="checkbox1_1">
                                                        <span></span>
                                                        <span class="check"></span>
                                                        <span class="box"></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <label class="col-md-2 control-label" for="form_control_1" style="text-align:left">
                                            Last Record
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-1">
                                            <div class="md-radio-inline">
                                                <div class="md-radio">
                                                    <input type="radio" id="checkbox1_2" name="radioTimeFilter" value="Calender" class="md-radiobtn">
                                                    <label for="checkbox1_2">
                                                        <span></span>
                                                        <span class="check"></span>
                                                        <span class="box"></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-5">
                                            <div id="filterStartDate" class="input-group date form_date form_datetime bs-datetime">
                                                <input id="startDateinput" class="form-control" size="16" type="text" value="Select start date" readonly disabled>
                                                <span class="input-group-addon">
                                                    <button class="btn default date-reset" type="button">
                                                        <i class="fa fa-times"></i>
                                                    </button>
                                                </span>
                                                <span class="input-group-addon">
                                                    <button id="startDateCalBtn" class="btn default date-set" type="button" disabled>
                                                        <i class="fa fa-calendar"></i>
                                                    </button>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="col-md-5">
                                            <div id="filterEndDate" class="input-group date form_date form_datetime bs-datetime">
                                                <input id="endDateinput" class="form-control" size="16" type="text" value="Select end date" readonly disabled>
                                                <span class="input-group-addon">
                                                    <button class="btn default date-reset" type="button">
                                                        <i class="fa fa-times"></i>
                                                    </button>
                                                </span>
                                                <span class="input-group-addon">
                                                    <button id="endDateCalBtn" class="btn default date-set" type="button" disabled>
                                                        <i class="fa fa-calendar"></i>
                                                    </button>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-------------------------Time Filter End----------------------------->
                                <!-------------------------Group Filter Begin----------------------------->
                                <div class="form-group form-md-radios">
                                    <label style="border-bottom: 1px solid #eee; text-align:left; font-weight:bold" class="control-label  col-md-12" for="form_control_1">Group Filter</label>
                                </div>
                                <div class="form-body">
                                    <div class="form-group form-md-radios">
                                        <div class="col-md-1">
                                            <div class="md-radio-inline">
                                                <div class="md-radio">
                                                    <input checked type="radio" id="checkbox1_3" name="radioGroupFilter" value="None" class="md-radiobtn">
                                                    <label for="checkbox1_3">
                                                        <span></span>
                                                        <span class="check"></span>
                                                        <span class="box"></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <label class="col-md-2 control-label" for="form_control_1" style="text-align:left">
                                            None
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-1">
                                            <div class="md-radio-inline">
                                                <div class="md-radio">
                                                    <input type="radio" id="checkbox1_4" name="radioGroupFilter" value="GroupFilter" class="md-radiobtn">
                                                    <label for="checkbox1_4">
                                                        <span></span>
                                                        <span class="check"></span>
                                                        <span class="box"></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <button id="sourceRoot" type="submit" class="btn green" disabled><i class="fa fa-sitemap"></i></button>
                                        </div>
                                        <div class="col-md-2">
                                            <button id="sourceGroup" type="submit" class="btn green" disabled><i class="fa fa-eye"></i></button>
                                        </div>
                                    </div>
                                </div>
                                <!-------------------------Group Filter End----------------------------->
                                <!-------------------------Column Filter Begin----------------------------->
                                <div class="form-group form-md-radios">
                                    <label style="border-bottom: 1px solid #eee; text-align:left; font-weight:bold" class="control-label  col-md-12" for="form_control_1">Column Filter</label>
                                </div>
                                <div class="form-body">
                                    <div class="form-group form-md-radios">
                                        <div class="col-md-1">
                                            <div class="md-radio-inline">
                                                <div class="md-radio">
                                                    <input checked type="radio" id="checkbox1_5" name="radioColumnFilter" value="none" class="md-radiobtn">
                                                    <label for="checkbox1_5">
                                                        <span></span>
                                                        <span class="check"></span>
                                                        <span class="box"></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <label class="col-md-2 control-label" for="form_control_1" style="text-align:left">
                                            None
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-1">
                                            <div class="md-radio-inline">
                                                <div class="md-radio">
                                                    <input type="radio" id="checkbox1_6" name="radioColumnFilter" value="ColumnFilter" class="md-radiobtn">
                                                    <label for="checkbox1_6">
                                                        <span></span>
                                                        <span class="check"></span>
                                                        <span class="box"></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group form-md-line-input">
                                            <div class="col-md-4">
                                                <select id="searchColumn" class="bs-select form-control selectpicker" disabled>
                                                    <option value="ac_name">Name</option>
                                                    <option value="ac_ipaddress">Ip Address</option>
                                                    <option value="ac_macaddress">MAC Address </option>
                                                </select>
                                            </div>
                                            <div class="col-md-5">
                                                <div class="input-icon">
                                                    <input id="searchContent" type="text" class="form-control" placeholder="Enter special device" disabled>
                                                    <div class="form-control-focus"> </div>
                                                    <i class="fa fa-edit"></i>
                                                    <span class="help-block">Enter special device</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-------------------------Column Filter End----------------------------->
                                <!-------------------------Device Filter Begin----------------------------->
                                <div class="form-group form-md-radios">
                                    <label style="border-bottom: 1px solid #eee; text-align:left; font-weight:bold" class="control-label  col-md-12" for="form_control_1">Device Status Filter</label>
                                </div>
                                <div class="col-md-1"></div>
                                <div class="col-md-10">
                                    <div class="form-group">
                                        <select id="deviceStatus" class="bs-select form-control">
                                            <option value="4" selected>All</option>
                                            <option value="0">Good</option>
                                            <option value="1">Warning </option>
                                            <option value="2">Unreachable</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-actions">
                                <div class="row">
                                    <div class="col-md-offset-3 col-md-9">
                                        <button id="filterQueryBtn" type="submit" class="btn green">Get Qery Filter</button>
                                        <button type="reset" class="btn default">Reset</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <!-- END FORM-->
                    </div>
                </div>
                <!-- END VALIDATION STATES-->
            </div>
            <div id="acNetworkMonitor" class="col-md-7">
                <!-- BEGIN VALIDATION STATES-->
                <div class="portlet light ">
                    <div class="portlet-title">
                        <div class="caption">
                            <i class=" icon-settings font-green"></i>
                            <span class="caption-subject font-green sbold uppercase">AP DEVICES LIST</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <!-- BEGIN TABLE-->
                        <table id="activeAlarms" class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th class="all">Record Time</th>
                                    <th class="all">Name</th>
                                    <th class="all">IP Address</th>
                                    <th class="all">Mac Address</th>
                                    <th class="all">Transmit (MB)</th>
                                    <th class="all">Recieve (MB)</th>
                                    <th class="all">Action</th>
                                </tr>
                            </thead>
                            <tbody data-bind="dataTablesForEach : {
			                                data: setTableAcMonitor,
			                                options: {
				                                deferRender: true,
				                                paging: true,
				                                fixedColumns: {
					                                leftColumns: 2
				                                },
				                                scrollX: false
			                                }
		                                }">
                                <tr>
                                    <td><a href="#"><span data-bind="text: moment(recordTime()).format('DD-MM-YYYY HH:mm:ss')"></span></a></td>
                                    <td><span data-bind="text: ac.name()"></span></td>
                                    <td><span data-bind="text: ac.ipaddress()"></span></td>
                                    <td><span data-bind="text: ac.macaddress()"></span></td>
                                    <td><span data-bind="text: transmitMegabyte()"></span></td>
                                    <td><span data-bind="text: receiveMegabyte()"></span></td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                        <!-- END TABLE-->
                    </div>
                </div>
                <!-- END VALIDATION STATES-->
            </div>
        </div>
    </div>
    <!-- END CONTENT BODY -->
</div>
<!-- END CONTENT -->


<script src="../assets/global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="../assets/pages/scripts/form-validation-md.min.js" type="text/javascript"></script>
<script src="../assets/pages/scripts/table-datatables-responsive.min.js" type="text/javascript"></script>

<script>
    $(function () {

    });
    $(document).ready(function () {

        var startDateFilter = 0;
        var endDateFilter = 0;
        var groupIdStr = 1;
        var searchColumn = 'none';
        var searchContent = '';
        var radioTimeFilter = $('#checkbox1_1').val();
        var radioGroupFilter = $('#checkbox1_3').val();
        var radioColumnFilter = $('#checkbox1_5').val();
        var dataCount = 0;
        var deviceStatus =  $('#deviceStatus').find("option:selected").val();
        var pageIndex = 0;
        var column = 'recordTime';
        var method = 'asc';

        ko.bindingHandlers.dataTablesForEach = {
            page: 0,
            init: function (element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
                var binding = ko.utils.unwrapObservable(valueAccessor());

                ko.unwrap(binding.data);

                if (binding.options.paging) {
                    binding.data.subscribe(function (changes) {
                        var table = $(element).closest('table').DataTable();
                        ko.bindingHandlers.dataTablesForEach.page = table.page();
                        table.destroy();
                    }, null, 'arrayChange');
                }

                var nodes = Array.prototype.slice.call(element.childNodes, 0);
                ko.utils.arrayForEach(nodes, function (node) {
                    if (node && node.nodeType !== 1) {
                        node.parentNode.removeChild(node);
                    }
                });

                return ko.bindingHandlers.foreach.init(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext);
            },
            update: function (element, valueAccessor, allBindings, viewModel, bindingContext) {
                var binding = ko.utils.unwrapObservable(valueAccessor()),
                    key = 'DataTablesForEach_Initialized';

                ko.unwrap(binding.data);

                var table;
                if (!binding.options.paging) {
                    table = $(element).closest('table').DataTable();
                    table.destroy();
                }

                ko.bindingHandlers.foreach.update(element, valueAccessor, allBindings, viewModel, bindingContext);

                table = $(element).closest('table').DataTable(binding.options);

                if (binding.options.paging) {
                    if (table.page.info().pages - ko.bindingHandlers.dataTablesForEach.page === 0) {
                        table.page(--ko.bindingHandlers.dataTablesForEach.page).draw(false);
                    } else {
                        table.page(ko.bindingHandlers.dataTablesForEach.page).draw(false);
                    }
                }

                if (!ko.utils.domData.get(element, key) && (binding.data || binding.length)) {
                    ko.utils.domData.set(element, key, true);
                }

                return {
                    controlsDescendantBindings: true
                };
            }
        };

        var AcNetworkMonitor = {
            setTableAcMonitor: ko.observableArray([])
        };

        ko.applyBindings(AcNetworkMonitor, document.getElementById('acNetworkMonitor'));

        $("input[name=radioTimeFilter]").change(function () {
            radioTimeFilter = this.value;
            if (radioTimeFilter === 'Calender')
            {
                $("#startDateinput").attr("disabled", false);
                $("#endDateinput").attr("disabled", false);
                $("#startDateCalBtn").attr("disabled", false);
                $("#endDateCalBtn").attr("disabled", false);
                startDateFilter = (moment($('#filterStartDate').data().date).unix()) * 1000;
                endDateFilter = (moment($('#filterEndDate').data().date).unix()) * 1000;
            }
            else
            {
                $("#startDateinput").attr("disabled", true);
                $("#endDateinput").attr("disabled", true);
                $("#startDateCalBtn").attr("disabled", true);
                $("#endDateCalBtn").attr("disabled", true);
                startDateFilter = 0;
                endDateFilter = 0;
            }
        });

        $("input[name=radioGroupFilter]").change(function () {
            radioGroupFilter = this.value;
            if (radioGroupFilter === 'None') {
                $("#sourceRoot").attr("disabled", true);
                $("#sourceGroup").attr("disabled", true);
            }
            else {
                $("#sourceRoot").attr("disabled", false);
                $("#sourceGroup").attr("disabled", false);
            }
        });

        $("input[name=radioColumnFilter]").change(function () {
            radioColumnFilter = this.value;
            if (radioColumnFilter === 'none') {
                $('#searchColumn').prop('disabled', true).selectpicker('refresh');
                $("#searchContent").attr("disabled", true);
                searchColumn = 'none';
                $('#searchContent').val('');
                $('#searchContent').text('');
                console.log($('#searchContent').val());
                console.log($('#searchContent').text());
            }
            else {
                $('#searchColumn').prop('disabled', false).selectpicker('refresh');
                $("#searchContent").attr("disabled", false);
            }
        });

        $('#deviceStatus').change(function () {
            deviceStatus = $(this).val();
        });

        $('#searchColumn').change(function () {
            searchColumn = $(this).val();
        });

        $('#filterQueryBtn').on('click', function ()
        {
            AcNetworkMonitor.setTableAcMonitor([]);

            if (radioTimeFilter != 'Calender')
            {
                if (startDateFilter == 0 & endDateFilter == 0 & groupIdStr == 1)
                {
                    searchContent = $('#searchContent').val();
                    $.ajax({
                        url: "http://217.78.97.240:8081/data/asset/wirelessInformation/count/ac/" + startDateFilter + "/" + endDateFilter + "/" + groupIdStr + "/" + deviceStatus + "/" + searchColumn + "/" + searchContent,
                        success: function (ResponseACMonitorCount) {
                            dataCount = ResponseACMonitorCount;
                        }
                    });

                    $.ajax({
                        url: "http://217.78.97.240:8081/data/asset/wirelessInformation/ac/" + startDateFilter + "/" + endDateFilter + "/100/" + pageIndex + "/" + column + "/" + method + "/" + groupIdStr + "/" + deviceStatus + "/" + searchColumn + "/" + searchContent,
                        success: function (ResponseACMonitors) {
                            ko.mapping.fromJS(ResponseACMonitors, {}, AcNetworkMonitor.setTableAcMonitor);
                        }
                    });

                }
            }
            else
            {
                startDateFilter = (moment($('#filterStartDate').data().date).unix()) * 1000;
                endDateFilter = (moment($('#filterEndDate').data().date).unix()) * 1000;
                searchContent = $('#searchContent').val();
                $.ajax({
                    url: "http://217.78.97.240:8081/data/asset/wirelessInformation/ac/" + startDateFilter + "/" + endDateFilter + "/100/" + pageIndex + "/" + column + "/" + method + "/" + groupIdStr + "/" + deviceStatus + "/" + searchColumn + "/" + searchContent,
                    success: function (ResponseACMonitors) {
                        ko.mapping.fromJS(ResponseACMonitors, {}, AcNetworkMonitor.setTableAcMonitor);
                    }
                });
            }
        });

        $('.form_date').datetimepicker({
            startDate: '2017-01-01 00:01',
            language: 'en',
            //format: "dd MM yyyy - HH:ii P",
            weekStart: 1,
            todayBtn: true,
            autoclose: true,
            todayHighlight: true,
            isRTL: App.isRTL(),
            pickerPosition: (App.isRTL() ? "bottom-right" : "bottom-left")
        });

    });
</script> 